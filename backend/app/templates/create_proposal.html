{% extends "base.html" %}

{% block content %}

<style>
/* ===== Layout geral ===== */
.page-wrap{
  max-width: 980px;
  margin: 0 auto;
}

.hero{
  margin: 10px 0 18px 0;
  padding: 18px 18px;
  border: 1px solid #e5e7eb;
  border-radius: 16px;
  background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
}

.hero h2{
  margin: 0 0 6px 0;
  font-size: 22px;
  font-weight: 800;
  letter-spacing: -0.2px;
}

.hero p{
  margin: 0;
  color: #4b5563;
  line-height: 1.5;
  font-size: 14px;
}

.hero .hint{
  margin-top: 10px;
  display: inline-flex;
  gap: 10px;
  flex-wrap: wrap;
}

.pill{
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-size: 12px;
  font-weight: 600;
  color: #111827;
  background: #eef2ff;
  border: 1px solid #e0e7ff;
  padding: 6px 10px;
  border-radius: 999px;
}

/* ===== Presets por categoria ===== */
.preset-title{
  margin: 18px 0 8px 0;
  font-size: 15px;
  font-weight: 800;
  color: #111827;
}

.preset-sub{
  margin: 0 0 12px 0;
  font-size: 13px;
  color: #6b7280;
}

.category{
  margin: 14px 0 18px 0;
}

.category-header{
  display:flex;
  align-items: baseline;
  justify-content: space-between;
  gap: 10px;
  margin: 0 0 10px 0;
}

.category-name{
  font-size: 13px;
  font-weight: 900;
  color: #111827;
}

.category-note{
  font-size: 12px;
  color: #6b7280;
}

.preset-cards{
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 14px;
  margin-bottom: 6px;
}

.preset-card{
  border: 1px solid #e5e7eb;
  border-radius: 16px;
  padding: 16px;
  background: #ffffff;
  cursor: pointer;
  transition: all .18s ease;
  box-shadow: 0 1px 2px rgba(0,0,0,0.04);
}

.preset-card:hover{
  border-color: #2563eb;
  box-shadow: 0 10px 26px rgba(37,99,235,0.14);
  transform: translateY(-2px);
}

.preset-card h4{
  margin: 0 0 6px 0;
  font-size: 15px;
  font-weight: 800;
  color: #111827;
}

.preset-card p{
  margin: 0 0 10px 0;
  font-size: 13px;
  color: #4b5563;
  line-height: 1.45;
}

.preset-card .row{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

.badge{
  font-size: 11px;
  font-weight: 700;
  color: #2563eb;
  background: #eff6ff;
  border: 1px solid #dbeafe;
  padding: 4px 10px;
  border-radius: 999px;
}

.small-link{
  font-size: 12px;
  color: #2563eb;
  text-decoration: underline;
  cursor: pointer;
}

/* ===== Form / card ===== */
.form-card{
  border: 1px solid #e5e7eb;
  border-radius: 16px;
  background: #ffffff;
  padding: 18px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.04);
}

.form-grid{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
}

@media (max-width: 760px){
  .form-grid{ grid-template-columns: 1fr; }
}

.section-title{
  margin: 14px 0 8px 0;
  font-size: 14px;
  font-weight: 900;
  color: #111827;
}

.help{
  margin: -2px 0 10px 0;
  font-size: 12px;
  color: #6b7280;
}

label{
  display: block;
  font-size: 12px;
  font-weight: 700;
  color: #111827;
  margin-bottom: 6px;
}

input[type="text"], select, textarea{
  width: 100%;
  box-sizing: border-box;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 10px 12px;
  font-size: 14px;
  outline: none;
  background: #ffffff;
}

textarea{ resize: vertical; min-height: 88px; }

input[type="text"]:focus, select:focus, textarea:focus{
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.12);
}

.actions{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-top: 14px;
  flex-wrap: wrap;
}

.primary-btn{
  appearance: none;
  border: none;
  border-radius: 12px;
  padding: 12px 16px;
  font-weight: 900;
  font-size: 14px;
  cursor: pointer;
  background: #2563eb;
  color: white;
  transition: transform .12s ease, box-shadow .12s ease;
  box-shadow: 0 10px 20px rgba(37,99,235,0.18);
}

.primary-btn:hover{ transform: translateY(-1px); }
.primary-btn:active{ transform: translateY(0px); }

.secondary-btn{
  border: 1px solid #e5e7eb;
  background: #ffffff;
  color: #111827;
  border-radius: 12px;
  padding: 10px 14px;
  font-weight: 800;
  font-size: 13px;
  cursor: pointer;
}

.secondary-btn:hover{ border-color: #cbd5e1; }

.error-box{
  border: 1px solid #fecaca;
  background: #fff1f2;
  color: #991b1b;
  border-radius: 14px;
  padding: 12px 14px;
  margin: 10px 0 14px 0;
  font-size: 13px;
}
</style>

<div class="page-wrap">

  <div class="hero">
    <h2>Criar proposta em minutos</h2>
    <p>Preencha os dados abaixo e gere um texto pronto para enviar. Depois voc√™ pode salvar e baixar em PDF com apar√™ncia profissional.</p>

    <div class="hint">
      <span class="pill">‚ö° R√°pido</span>
      <span class="pill">üìÑ Texto pronto + PDF</span>
      <span class="pill">‚úÖ Visual profissional</span>
    </div>
  </div>

  {% if error %}
    <div class="error-box">{{ error }}</div>
  {% endif %}

  <div>
    <div class="preset-title">Modelos por categoria (1 clique)</div>
    <div class="preset-sub">Escolha um nicho, aplique o modelo e depois ajuste valor/prazo como quiser.</div>

    <!-- MARKETING -->
    <div class="category">
      <div class="category-header">
        <div class="category-name">Marketing</div>
        <div class="category-note">Ideal para servi√ßos cont√≠nuos e performance</div>
      </div>
      <div class="preset-cards">
        <div class="preset-card" onclick="applyPreset('social')">
          <h4>Social Media Premium</h4>
          <p>Contrato mensal focado em vendas e acompanhamento cont√≠nuo.</p>
          <div class="row">
            <span class="badge">1 clique</span>
            <span class="small-link">Aplicar modelo</span>
          </div>
        </div>

        <div class="preset-card" onclick="applyPreset('trafego')">
          <h4>Tr√°fego Pago</h4>
          <p>Gest√£o de campanhas com otimiza√ß√£o e foco em resultado.</p>
          <div class="row">
            <span class="badge">1 clique</span>
            <span class="small-link">Aplicar modelo</span>
          </div>
        </div>

        <div class="preset-card" onclick="applyPreset('design')">
          <h4>Design / Criativos</h4>
          <p>Cria√ß√£o de pe√ßas, identidade visual e materiais para convers√£o.</p>
          <div class="row">
            <span class="badge">1 clique</span>
            <span class="small-link">Aplicar modelo</span>
          </div>
        </div>
      </div>
    </div>

    <!-- WEB -->
    <div class="category">
      <div class="category-header">
        <div class="category-name">Web</div>
        <div class="category-note">Projetos com entrega definida</div>
      </div>
      <div class="preset-cards">
        <div class="preset-card" onclick="applyPreset('site')">
          <h4>Cria√ß√£o de Site</h4>
          <p>Projeto com prazo definido, ideal para fechar r√°pido com clareza.</p>
          <div class="row">
            <span class="badge">1 clique</span>
            <span class="small-link">Aplicar modelo</span>
          </div>
        </div>

        <div class="preset-card" onclick="applyPreset('landing')">
          <h4>Landing Page</h4>
          <p>P√°gina focada em convers√£o com estrutura direta e persuasiva.</p>
          <div class="row">
            <span class="badge">1 clique</span>
            <span class="small-link">Aplicar modelo</span>
          </div>
        </div>
      </div>
    </div>

    <!-- SERVI√áOS -->
    <div class="category">
      <div class="category-header">
        <div class="category-name">Servi√ßos</div>
        <div class="category-note">Para profissionais e prestadores locais</div>
      </div>
      <div class="preset-cards">
        <div class="preset-card" onclick="applyPreset('consultoria')">
          <h4>Consultoria</h4>
          <p>Diagn√≥stico + plano de a√ß√£o com encontros e entrega estruturada.</p>
          <div class="row">
            <span class="badge">1 clique</span>
            <span class="small-link">Aplicar modelo</span>
          </div>
        </div>

        <div class="preset-card" onclick="applyPreset('prestador')">
          <h4>Prestador Local</h4>
          <p>Servi√ßo pr√°tico com escopo claro, prazo e condi√ß√µes objetivas.</p>
          <div class="row">
            <span class="badge">1 clique</span>
            <span class="small-link">Aplicar modelo</span>
          </div>
        </div>
      </div>
    </div>

    <!-- RECORRENTES -->
    <div class="category">
      <div class="category-header">
        <div class="category-name">Recorrentes</div>
        <div class="category-note">Contratos mensais e pacotes</div>
      </div>
      <div class="preset-cards">
        <div class="preset-card" onclick="applyPreset('mensal')">
          <h4>Mensal</h4>
          <p>Modelo pronto para contratos com renova√ß√£o e rotina definida.</p>
          <div class="row">
            <span class="badge">1 clique</span>
            <span class="small-link">Aplicar modelo</span>
          </div>
        </div>

        <div class="preset-card" onclick="applyPreset('contrato_fechado')">
          <h4>Contrato Fechado</h4>
          <p>Projeto fechado com fases, entregas e crit√©rios de aceite.</p>
          <div class="row">
            <span class="badge">1 clique</span>
            <span class="small-link">Aplicar modelo</span>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- ===== FORMUL√ÅRIO (mant√©m names + action para bater com routes.py) ===== -->
  <form method="post" action="/create" class="form-card">

    <input type="hidden" name="preset_id" id="preset_id" value="">

    <div class="section-title">Dados do cliente</div>
    <div class="help">Esses dados aparecem no topo da proposta e ajudam a personalizar.</div>

    <div class="form-grid">
      <div>
        <label>Nome do cliente</label>
        <input type="text" name="client_name" id="client_name" placeholder="Ex.: Mariana Oliveira" required>
      </div>

      <div>
        <label>Servi√ßo</label>
        <input type="text" name="service" id="service" placeholder="Ex.: Cria√ß√£o de Site Profissional" required>
      </div>
    </div>

    <div class="section-title">Detalhes do servi√ßo</div>
    <div class="help">Quanto mais claro o escopo, melhor fica o texto final.</div>

    <div>
      <label>Escopo</label>
      <textarea name="scope" id="scope" placeholder="Descreva o que est√° inclu√≠do (ex.: posts, stories, atendimento, p√°ginas do site, integra√ß√µes, etc.)" required></textarea>
    </div>

    <div class="form-grid" style="margin-top: 14px;">
      <div>
        <label>Prazo</label>
        <input type="text" name="deadline" id="deadline" placeholder="Ex.: 15 dias / 30 dias / 3 meses" required>
      </div>

      <div>
        <label>Investimento (valor)</label>
        <input type="text" name="price" id="price" placeholder="Ex.: R$ 1.500,00" required>
      </div>
    </div>

    <div class="section-title">Condi√ß√µes e diferenciais</div>
    <div class="help">Essas informa√ß√µes deixam a proposta mais persuasiva e completa.</div>

    <div>
      <label>Condi√ß√µes de pagamento</label>
      <input type="text" name="payment_terms" id="payment_terms" placeholder="Ex.: 50% na entrada e 50% na entrega" required>
    </div>

    <div class="form-grid" style="margin-top: 14px;">
      <div>
        <label>Diferenciais</label>
        <textarea name="differentiators" id="differentiators" placeholder="Ex.: foco em convers√£o, relat√≥rios, estrat√©gia, acompanhamento, otimiza√ß√£o cont√≠nua" required></textarea>
      </div>

      <div>
        <label>Garantia / Suporte</label>
        <textarea name="warranty_support" id="warranty_support" placeholder="Ex.: suporte por 30 dias ap√≥s entrega, ajustes inclusos, acompanhamento semanal" required></textarea>
      </div>
    </div>

    <div class="section-title">Tom e objetivo</div>
    <div class="help">Ajuste a linguagem da proposta para o tipo de cliente e inten√ß√£o.</div>

    <div class="form-grid">
      <div>
        <label>Tom</label>
        <select name="tone" id="tone" required>
          <option value="profissional" selected>Profissional</option>
          <option value="direto">Direto</option>
          <option value="consultivo">Consultivo</option>
          <option value="premium">Premium</option>
        </select>
      </div>

      <div>
        <label>Objetivo</label>
        <select name="objective" id="objective" required>
          <option value="fechar" selected>Fechar a proposta</option>
          <option value="agendar">Agendar reuni√£o</option>
          <option value="prospeccao">Prospec√ß√£o</option>
          <option value="renovacao">Renova√ß√£o</option>
        </select>
      </div>
    </div>

    <div class="actions">
      <button type="submit" class="primary-btn">Gerar proposta</button>
      <a href="/history" class="secondary-btn" style="text-decoration:none; display:inline-block;">Ver hist√≥rico</a>
    </div>

  </form>

</div>

<script>
  // Presets vindos do backend (routes.py passa {"presets": PRESETS})
  const PRESETS = {{ presets | default({}) | tojson }};

  function setField(id, value) {
    const el = document.getElementById(id);
    if (!el) return;
    if ((el.value || '').trim() === '') {
      el.value = value || '';
    }
  }

  function applyPreset(presetId) {
    document.getElementById('preset_id').value = presetId;

    const p = (PRESETS && PRESETS[presetId]) ? PRESETS[presetId] : null;

    // 1) Se existir no backend, usa os campos do preset de verdade
    if (p) {
      setField('service', p.service);
      setField('scope', p.scope);
      setField('deadline', p.deadline);
      setField('price', p.price);
      setField('payment_terms', p.payment_terms);
      setField('differentiators', p.differentiators);
      setField('warranty_support', p.warranty_support);

      if (p.tone) document.getElementById('tone').value = p.tone;
      if (p.objective) document.getElementById('objective').value = p.objective;
      return;
    }

    // 2) Fallback (n√£o quebra se voc√™ ainda n√£o criou esses presets no backend)
    // Voc√™ pode deixar assim por enquanto e depois criar os presets no PRESETS.
    const FALLBACK = {
      social: {
        service: 'Gest√£o de Social Media Premium',
        scope: 'Planejamento, cria√ß√£o de posts e stories, acompanhamento e otimiza√ß√£o para vendas.',
        deadline: '30 dias',
        price: 'R$ 1.500,00',
        payment_terms: 'Mensal (pagamento antecipado).',
        differentiators: 'Foco em convers√£o, relat√≥rios e acompanhamento cont√≠nuo.',
        warranty_support: 'Suporte durante todo o per√≠odo contratado.',
        tone: 'profissional',
        objective: 'fechar'
      },
      site: {
        service: 'Cria√ß√£o de Site Profissional',
        scope: 'Site institucional com p√°ginas essenciais, formul√°rio de contato e responsivo.',
        deadline: '15 dias',
        price: 'R$ 2.500,00',
        payment_terms: '50% na entrada e 50% na entrega.',
        differentiators: 'Design moderno, performance e foco em clareza comercial.',
        warranty_support: 'Suporte por 30 dias ap√≥s entrega, com ajustes simples.',
        tone: 'profissional',
        objective: 'fechar'
      },
      trafego: {
        service: 'Gest√£o de Tr√°fego Pago',
        scope: 'Configura√ß√£o e gest√£o de campanhas, otimiza√ß√£o, testes e acompanhamento de desempenho.',
        deadline: '30 dias',
        price: 'R$ 1.200,00',
        payment_terms: 'Mensal (pagamento antecipado).',
        differentiators: 'Otimiza√ß√£o cont√≠nua, foco em ROI e relat√≥rios peri√≥dicos.',
        warranty_support: 'Suporte durante o per√≠odo contratado.',
        tone: 'profissional',
        objective: 'fechar'
      },
      design: {
        service: 'Design / Criativos',
        scope: 'Cria√ß√£o de artes e pe√ßas para redes sociais/an√∫ncios, com revis√µes combinadas.',
        deadline: '7 dias',
        price: 'R$ 800,00',
        payment_terms: '50% na entrada e 50% na entrega.',
        differentiators: 'Criativos orientados √† convers√£o, consist√™ncia visual e agilidade.',
        warranty_support: 'Ajustes simples por 7 dias ap√≥s entrega.',
        tone: 'profissional',
        objective: 'fechar'
      },
      landing: {
        service: 'Landing Page (Convers√£o)',
        scope: 'Landing page com estrutura persuasiva, responsiva e pronta para capta√ß√£o/leads.',
        deadline: '10 dias',
        price: 'R$ 1.800,00',
        payment_terms: '50% na entrada e 50% na entrega.',
        differentiators: 'Foco em convers√£o, copy clara e performance.',
        warranty_support: 'Suporte por 15 dias ap√≥s entrega.',
        tone: 'profissional',
        objective: 'fechar'
      },
      consultoria: {
        service: 'Consultoria',
        scope: 'Diagn√≥stico, plano de a√ß√£o e encontros para orientar execu√ß√£o e resultados.',
        deadline: '15 dias',
        price: 'R$ 1.000,00',
        payment_terms: 'Pagamento antecipado.',
        differentiators: 'Plano pr√°tico, acompanhamento e direcionamento estrat√©gico.',
        warranty_support: 'Suporte por 15 dias ap√≥s entrega.',
        tone: 'consultivo',
        objective: 'agendar'
      },
      prestador: {
        service: 'Servi√ßo Local (Prestador)',
        scope: 'Execu√ß√£o do servi√ßo conforme escopo combinado, com prazos e condi√ß√µes definidas.',
        deadline: '7 dias',
        price: 'R$ 600,00',
        payment_terms: '50% na entrada e 50% na entrega.',
        differentiators: 'Agilidade, transpar√™ncia e qualidade na entrega.',
        warranty_support: 'Garantia conforme combinado.',
        tone: 'direto',
        objective: 'fechar'
      },
      mensal: {
        service: 'Contrato Mensal (Recorrente)',
        scope: 'Presta√ß√£o cont√≠nua do servi√ßo com rotina definida e entregas mensais.',
        deadline: '30 dias',
        price: 'R$ 1.000,00',
        payment_terms: 'Mensal (pagamento antecipado).',
        differentiators: 'Consist√™ncia, acompanhamento e melhoria cont√≠nua.',
        warranty_support: 'Suporte durante todo o per√≠odo contratado.',
        tone: 'profissional',
        objective: 'fechar'
      },
      contrato_fechado: {
        service: 'Projeto (Contrato Fechado)',
        scope: 'Projeto fechado com fases, entregas, crit√©rios de aceite e prazos definidos.',
        deadline: '20 dias',
        price: 'R$ 3.000,00',
        payment_terms: '40% na entrada, 30% no meio e 30% na entrega.',
        differentiators: 'Organiza√ß√£o por fases, clareza de entrega e seguran√ßa comercial.',
        warranty_support: 'Suporte por 30 dias ap√≥s entrega.',
        tone: 'profissional',
        objective: 'fechar'
      }
    };

    const f = FALLBACK[presetId];
    if (!f) return;

    setField('service', f.service);
    setField('scope', f.scope);
    setField('deadline', f.deadline);
    setField('price', f.price);
    setField('payment_terms', f.payment_terms);
    setField('differentiators', f.differentiators);
    setField('warranty_support', f.warranty_support);

    if (f.tone) document.getElementById('tone').value = f.tone;
    if (f.objective) document.getElementById('objective').value = f.objective;
  }
</script>

<!--
TESTE
1) Rode o backend e abra /create no navegador.
2) Verifique que o campo "Servi√ßo" inicia VAZIO.
3) Clique em um card (ex.: "Social Media Premium") -> o campo "Servi√ßo" deve ser preenchido com o valor do modelo.
4) Clique em outro modelo com "Servi√ßo" ainda vazio (ou apague o conte√∫do e clique) -> deve preencher conforme o modelo escolhido.
O esperado: n√£o vir mais "Gest√£o de Social Media Premium" pr√©-preenchido ao entrar na p√°gina; o preenchimento acontece ao aplicar um modelo.
-->
{% endblock %}
